# https://rest.runpod.io/v1/docs

auth="Authorization: Bearer ${RUNPOD_API_KEY}"
json="Content-Type: application/json"
runpod=https://rest.runpod.io/v1
pod=https://$2-4000.proxy.runpod.net

case "$1" in
    list)
        curl -s $runpod/pods -X GET -H "$auth" | jq -r .[].id
        ;;
    start)
        curl -s $runpod/pods -X POST -H "$auth" -H "$json" -d '{
            "computeType": "CPU",
            "templateId": "0dc2j9qn8i"
        }' | jq -r .id
        ;;
    stop)
        curl -s $runpod/pods/$2 -X DELETE -H "$auth"
        ;;
    dial)
        curl -s $pod/threads -X POST
        ;;
    speek)
        curl -s $pod/threads/$3/messages -X POST -d "$4"
        ;;
    hangup)
        curl -s $pod/threads/$3 -X DELETE -o /dev/null
        ;;
esac

exit

hal=$(sh runpod start)
call=$(sh runpod dial $hal) && echo $call
sh runpod speek $hal $call "Set the bench to none, the model to o3-mini and the provider to openai."
sh runpod speek $hal $call 'Who is Gavin Newsom?'
sh runpod hangup $hal $call
sh runpod stop $hal
